

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>入门 &mdash; Kubernetes alpha documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link href="../../_static/style.css" rel="stylesheet" type="text/css">


  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Kubernetes
          

          
            
            <img src="../../_static/kubernetes-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../container/container.html">容器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment_guide.html">部署手册</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Kubernetes</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>入门</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/deployment_guide/kubespray/getting-started.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>入门<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="inventory">
<h2>建立自己的 inventory<a class="headerlink" href="#inventory" title="Permalink to this headline">¶</a></h2>
<p>Ansible inventory 可以使用三种格式存储：YAML、JSON 或 INI-like。查看示例 inventory 点击 <a class="reference external" href="https://github.com/kubernetes-incubator/kubespray/blob/master/inventory/sample/hosts.ini">这里</a> 。</p>
<p>你可以使用 <a class="reference external" href="https://github.com/kubernetes-incubator/kubespray/blob/master/contrib/inventory_builder/inventory.py">inventory generator</a> 去创建或修改 Ansible inventory。 目前，它的功能有限，仅用于配置基本的 Kubespray Cluster Inventory，但它也支持为大型集群创建 Inventory 文件。 如果大小超过某个阈值，它现在支持从节点角色分离 ETCD 和 Kubernetes Master 角色。 运行 <cite>python3 contrib/inventory_builder/inventory.py help</cite> 帮助获取更多信息。</p>
<p>inventory generator 使用示例：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>cp -r inventory/sample inventory/mycluster
<span class="nb">declare</span> -a <span class="nv">IPS</span><span class="o">=(</span><span class="m">10</span>.10.1.3 <span class="m">10</span>.10.1.4 <span class="m">10</span>.10.1.5<span class="o">)</span>
<span class="nv">CONFIG_FILE</span><span class="o">=</span>inventory/mycluster/hosts.ini python3 contrib/inventory_builder/inventory.py <span class="si">${</span><span class="nv">IPS</span><span class="p">[@]</span><span class="si">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>开始自定义部署<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>一旦你有了 Inventory 之后，你可能希望自定部署数据并开始部署。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">通过编辑 <code class="docutils literal"><span class="pre">my_inventory/groups_vars/*.yaml</span></code> 来覆盖变量数据。</p>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ansible-playbook -i inventory/mycluster/hosts.ini cluster.yml -b -v <span class="se">\</span>
  --private-key<span class="o">=</span>~/.ssh/private_key
</pre></div>
</div>
<p>可以从 <a href="#id9"><span class="problematic" id="id10">`Ansible 变量`_</span></a> 查看更多的细节。</p>
</div>
<div class="section" id="id4">
<h2>添加节点<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>你可能希望将 worker、master 或 etcd 节点添加到现有集群。这可以通过重新运行 <code class="docutils literal"><span class="pre">cluster.yml</span></code> playbook 来完成，或者你可以针对在 worker 上安装 kubelet 并从你的 master 计算出所需要的最低限制。在执行类似自动缩放的操作时，这尤为重要。</p>
<ul>
<li><p class="first">将新工作线程节点添加到相应组中的 invertory （或使用 <a class="reference external" href="https://docs.ansible.com/ansible/intro_dynamic_inventory.html">dynamic inventory</a> ）</p>
</li>
<li><p class="first">运行 ansible-playbook 命名，把 <cite>cluster.yml</cite> 替换为 <cite>scale.yml</cite>。</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>ansible-playbook -i inventory/mycluster/hosts.ini scale.yml -b -v <span class="se">\</span>
  --private-key<span class="o">=</span>~/.ssh/private_key
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id5">
<h2>删除节点<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>你可能希望将 <cite>worker</cite> 节点从现有集群中移除。这可以通过重新运行 <code class="docutils literal"><span class="pre">remove-node.yml</span></code> playbook 来实现。首先，将排空所有节点，然后停止一些 kubernetes 服务并删除一些证书，最后执行 kubectl 命令删除这些节点。这可以与添加节点功能结合使用。这在执行自动缩放集群等操作时通常很有用。当然，如果节点不能工作，您可以删除该节点并再次安装它。</p>
<p>如果要删除 worker 节点（或使用 <a class="reference external" href="https://docs.ansible.com/ansible/intro_dynamic_inventory.html">dynamic inventory</a> ），请将 worker 节点添加到 kube-node 下的列表中。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ansible-playbook -i inventory/mycluster/hosts.ini remove-node.yml -b -v <span class="se">\</span>
  --private-key<span class="o">=</span>~/.ssh/private_key
</pre></div>
</div>
<p>我们支持两种方式来选择节点：</p>
<ul class="simple">
<li>使用 <code class="docutils literal"><span class="pre">--extra-vars</span> <span class="pre">&quot;node=&lt;nodename&gt;,&lt;nodename2&gt;&quot;</span></code> 选择要删除的节点</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ansible-playbook -i inventory/mycluster/hosts.ini remove-node.yml -b -v <span class="se">\</span>
  --private-key<span class="o">=</span>~/.ssh/private_key <span class="se">\</span>
  --extra-vars <span class="s2">&quot;node=nodename,nodename2&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li>使用 <code class="docutils literal"><span class="pre">--limit</span> <span class="pre">nodename,nodename2</span></code> 选择要删除的节点</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ansible-playbook -i inventory/mycluster/hosts.ini remove-node.yml -b -v <span class="se">\</span>
  --private-key<span class="o">=</span>~/.ssh/private_key <span class="se">\</span>
  --limit nodename,nodename2<span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="kubernetes">
<h2>连接到 Kubernetes<a class="headerlink" href="#kubernetes" title="Permalink to this headline">¶</a></h2>
<p>默认情况下，Kubespray 通过 8080 端口配置对 kube-apiserver 不安全访问的 kube-master 主机。这种情况下，不需要 kubeconfig 文件，因为 kubectl 将使用 &lt;<a class="reference external" href="http://localhost:8080">http://localhost:8080</a>&gt; 进行连接。生成的 kubeconfig 文件将指向 localhost（在 kube-masters 上），并且 kube-node 主机将连接到 localhost nginx 代理或连接到负载均衡器（如果已配置）。[HA 指南](ha-mode.md) 中有关此过程的更多详细信息。</p>
<p>Kubespray 允许在端口 6443 上的任何 kube-master 主机的任何 IP 上远程连接到集群。但是，这需要身份验证。可以基于一个已安装 kube-master 主机（需要改进）生成 kubeconfig，或者使用用户名和密码进行连接。默认情况下，创建具有管理员权限的名为 kube 的用户。通过查看文件 <code class="docutils literal"><span class="pre">PATH_TO_KUBESPRAY/kube_user.creds</span></code>，可以在部署后查看密码。这包含随机生成的密码。如果你想设置自己的密码，只需自己预先创建/修改此文件。</p>
<p>有关 kubeconfig 和访问 Kubernetes 集群的更多信息，请参阅 Kubernetes <a class="reference external" href="https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/">文档</a> 。</p>
</div>
<div class="section" id="id8">
<h2>访问 Kubernetes 仪表盘<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>截止 kubernetes-dashboard v1.7.x:</p>
<ul class="simple">
<li>默认情况下使用 token/basic/kubeconfig 的 apiserver auth 代理新的登录选项</li>
<li>在 authorization_modes 中需要 RBAC</li>
<li>仅适用于 HTTPS</li>
<li>在使用 https 代理 URL 更新 apiserver 之前，&lt;<a class="reference external" href="https://first_master:6443/ui">https://first_master:6443/ui</a>&gt; 不再可用。</li>
</ul>
<p>如果设置了变量 dashboard_enabled（默认为 true），则可以通过以下 URL 访问 Kubernetes 仪表盘，系统将提示输入凭据：&lt;<a class="reference external" href="https://first_master:6443/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login">https://first_master:6443/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login</a>&gt;</p>
<p>或者你可以从本地计算机运行 “kubectl proxy” 以访问浏览器中的仪表盘：&lt;<a class="reference external" href="http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login">http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login</a>&gt;</p>
<p>建议从强制执行身份验证令牌的网关（如 Ingress Controller）后面访问仪表盘。详细信息和其他访问选项：&lt;<a class="reference external" href="https://github.com/kubernetes/dashboard/wiki/Accessing-Dashboard---1.7.X-and-above">https://github.com/kubernetes/dashboard/wiki/Accessing-Dashboard—1.7.X-and-above</a>&gt;</p>
</div>
<div class="section" id="kubernetes-api">
<h2>访问 Kubernetes API<a class="headerlink" href="#kubernetes-api" title="Permalink to this headline">¶</a></h2>
<p>Kubernetes 的主要客户是 <code class="docutils literal"><span class="pre">kubectl</span></code>。它安装在每个 kube-master 主机上，可以选择在 ansible 主机上配置，方法是在配置中设置 <code class="docutils literal"><span class="pre">kubectl_localhost:</span> <span class="pre">true</span></code> 和 <code class="docutils literal"><span class="pre">kubeconfig_localhost:</span> <span class="pre">true</span></code> 。</p>
<ul class="simple">
<li>如果开启 <code class="docutils literal"><span class="pre">kubectl_localhost</span></code>， <code class="docutils literal"><span class="pre">kubectl</span></code> 将会下载到 <code class="docutils literal"><span class="pre">/usr/local/bin/</span></code> 并通过 bash 完成设置。 还使用以下 <code class="docutils literal"><span class="pre">admin.conf</span></code> 为安装程序创建了一个帮助程序脚本 <code class="docutils literal"><span class="pre">inventory/mycluster/artifacts/kubectl.sh</span></code></li>
<li>如果开启 <code class="docutils literal"><span class="pre">kubectl_localhost</span></code>, <code class="docutils literal"><span class="pre">admin.conf</span></code> 将在部署后出现在 <code class="docutils literal"><span class="pre">inventory/mycluster/artifacts/</span></code> 目录中。</li>
</ul>
<p>您可以通过运行以下命令来查看节点列表：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> inventory/mycluster/artifacts
./kubectl.sh get nodes
</pre></div>
</div>
<p>如果需要，请将 <code class="docutils literal"><span class="pre">admin.conf</span></code> 复制到 <code class="docutils literal"><span class="pre">~/.kube/config</span></code> 目录中。</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, renkeju

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'alpha',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>